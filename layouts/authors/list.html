{{ define "main" }}
{{ if not .Params.author_key }}
  {{/* Section index page â€” not an individual author */}}
  <div class="bg-primaryBG relative overflow-hidden px-5 py-16 lg:py-24 lg:px-24">
    <div class="relative max-w-4xl mx-auto text-center">
      <h1 class="text-white text-[40px] lg:text-[68px] leading-[48px] lg:leading-[78px] mb-6">
        <span class="text-gradient">Authors</span>
      </h1>
    </div>
  </div>
  <div class="bg-[#F6F9FA]">
    <div class="max-w-4xl mx-auto px-6 lg:px-8 py-16 lg:py-24">
      <div class="flex flex-col gap-8">
        {{ range .Pages }}
          {{ $author := index site.Data.authors .Params.author_key }}
          {{ if $author }}
          <a href="{{ .RelPermalink }}" class="bg-white p-8 md:p-10 rounded-2xl shadow-sm border border-gray-100 flex flex-col md:flex-row items-center gap-8 md:gap-12 transition-all duration-300 hover:border-[#8A7DFF] hover:shadow-md no-underline">
            <div class="flex-shrink-0">
              {{ $imgPath := strings.TrimPrefix "/assets/" $author.image }}
              {{ $img := resources.Get $imgPath }}
              {{ if $img }}
                {{ $webp := $img.Process "fit 256x256 webp q80" }}
                <picture>
                  <source srcset="{{ $webp.RelPermalink }}" type="image/webp">
                  <img src="{{ $img.RelPermalink }}" alt="{{ $author.display_name }}" class="w-32 h-32 object-cover !m-0 grayscale hover:grayscale-0 transition-all duration-500" width="128" height="128" loading="lazy">
                </picture>
              {{ end }}
            </div>
            <div class="text-left flex-grow">
              <h2 class="text-2xl font-bold text-primaryText !mt-0 !mb-2">{{ $author.display_name }}</h2>
              <p class="text-secondaryText leading-relaxed mb-0 text-lg">{{ $author.bio | truncate 200 }}</p>
            </div>
          </a>
          {{ end }}
        {{ end }}
      </div>
    </div>
  </div>
{{ else }}
{{ $author := index site.Data.authors .Params.author_key }}

<!-- Schema.org Person markup -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Person",
  "name": "{{ $author.display_name }}",
  "url": "{{ .Permalink }}",
  "image": "{{ $author.image | absURL }}",
  "worksFor": {
    "@type": "Organization",
    "name": "sbomify",
    "url": "{{ site.BaseURL }}"
  },
  "description": "{{ $author.bio | plainify | htmlEscape }}",
  "sameAs": [
    {{ $sameAs := slice }}
    {{ with $author.linkedin }}{{ $sameAs = $sameAs | append . }}{{ end }}
    {{ with $author.twitter }}{{ $sameAs = $sameAs | append . }}{{ end }}
    {{ with $author.mastodon }}{{ $sameAs = $sameAs | append . }}{{ end }}
    {{ with $author.github }}{{ $sameAs = $sameAs | append . }}{{ end }}
    {{ with $author.website }}{{ $sameAs = $sameAs | append . }}{{ end }}
    {{ with $author.podcast }}{{ $sameAs = $sameAs | append . }}{{ end }}
    {{ range $i, $url := $sameAs }}{{ if $i }},{{ end }}"{{ $url }}"{{ end }}
  ]
}
</script>

<div>
  <div class="bg-primaryBG relative overflow-hidden px-5 py-16 lg:py-24 lg:px-24">
    <!-- Subtle gradient overlay -->
    <div class="absolute inset-0 bg-gradient-to-br from-[#8A7DFF]/5 via-transparent to-transparent pointer-events-none"></div>

    <div class="relative max-w-4xl mx-auto text-center">
      <h1 class="text-white text-[40px] lg:text-[68px] leading-[48px] lg:leading-[78px] mb-6">
        <span class="text-gradient">{{ $author.display_name }}</span>
      </h1>
    </div>
  </div>

  <div class="bg-[#F6F9FA]">
    <div class="max-w-4xl mx-auto px-6 lg:px-8 py-16 lg:py-24">
      <!-- Author Bio Section -->
      <article class="bg-white p-8 md:p-12 rounded-2xl shadow-sm border border-gray-100 mb-16">
        <div class="flex flex-col md:flex-row gap-8 md:gap-12">
          <!-- Author Photo -->
          <div class="flex-shrink-0 flex justify-center md:block">
            {{ $imgPath := strings.TrimPrefix "/assets/" $author.image }}
            {{ $img := resources.Get $imgPath }}
            {{ if $img }}
              {{ $webp := $img.Process "fit 448x448 webp q80" }}
              <picture>
                <source srcset="{{ $webp.RelPermalink }}" type="image/webp">
                <img src="{{ $img.RelPermalink }}" alt="{{ $author.display_name }}" class="w-48 h-48 md:w-56 md:h-56 object-cover !mb-0 !mt-0 grayscale hover:grayscale-0 transition-all duration-500" width="224" height="224" loading="lazy">
              </picture>
            {{ else }}
              <img src="{{ $author.image }}" alt="{{ $author.display_name }}" class="w-48 h-48 md:w-56 md:h-56 object-cover !mb-0 !mt-0 grayscale hover:grayscale-0 transition-all duration-500" width="224" height="224" loading="lazy">
            {{ end }}
          </div>

          <!-- Author Info -->
          <div class="flex-grow">
            <div class="flex flex-wrap items-center gap-3 mb-6">
              {{ with $author.linkedin }}
              <a href="{{ . }}" target="_blank" rel="noopener noreferrer" class="inline-flex items-center text-[#0077b5] hover:text-[#006097] transition-colors" title="LinkedIn">
                {{ partial "icon.html" (dict "name" "linkedin" "class" "w-6 h-6") }}
              </a>
              {{ end }}
              {{ with $author.twitter }}
              <a href="{{ . }}" target="_blank" rel="noopener noreferrer" class="inline-flex items-center text-gray-800 hover:text-gray-600 transition-colors" title="X (Twitter)">
                {{ partial "icon.html" (dict "name" "x-twitter" "class" "w-6 h-6") }}
              </a>
              {{ end }}
              {{ with $author.mastodon }}
              <a href="{{ . }}" target="_blank" rel="me noopener noreferrer" class="inline-flex items-center text-[#6364FF] hover:text-[#563ACC] transition-colors" title="Mastodon">
                {{ partial "icon.html" (dict "name" "mastodon" "class" "w-6 h-6") }}
              </a>
              {{ end }}
              {{ with $author.github }}
              <a href="{{ . }}" target="_blank" rel="noopener noreferrer" class="inline-flex items-center text-gray-800 hover:text-gray-600 transition-colors" title="GitHub">
                {{ partial "icon.html" (dict "name" "github" "class" "w-6 h-6") }}
              </a>
              {{ end }}
              {{ with $author.website }}
              <a href="{{ . }}" target="_blank" rel="noopener noreferrer" class="inline-flex items-center text-gray-600 hover:text-[#8A7DFF] transition-colors" title="Website">
                {{ partial "icon.html" (dict "name" "globe" "class" "w-6 h-6") }}
              </a>
              {{ end }}
              {{ with $author.podcast }}
              <a href="{{ . }}" target="_blank" rel="noopener noreferrer" class="inline-flex items-center text-gray-600 hover:text-[#8A7DFF] transition-colors" title="Podcast">
                {{ partial "icon.html" (dict "name" "podcast" "class" "w-6 h-6") }}
              </a>
              {{ end }}
            </div>

            <p class="text-gray-600 leading-relaxed text-lg">
              {{ $author.bio }}
            </p>
          </div>
        </div>
      </article>

      <!-- Posts by Author Section -->
      {{ $authorPosts := where (where site.RegularPages "Section" "posts") ".Params.author.display_name" $author.display_name }}
      {{ if gt (len $authorPosts) 0 }}
      {{ $paginator := .Paginate $authorPosts }}
      <div class="max-w-4xl mx-auto">
        <h2 class="text-3xl lg:text-4xl font-bold text-primaryText mb-12 text-center">Posts by {{ $author.display_name }}</h2>

        <div class="flex flex-col gap-6">
          {{ range $paginator.Pages }}
          <a href="{{ .RelPermalink }}" class="bg-white p-6 md:p-8 rounded-2xl shadow-sm border border-gray-100 transition-all duration-300 hover:border-[#8A7DFF] hover:shadow-md block no-underline">
            <h3 class="text-xl font-bold text-primaryText mb-2 !mt-0">{{ .Title }}</h3>
            <div class="flex flex-wrap items-center gap-3 text-sm text-gray-500 mb-3">
              <time datetime="{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}">
                {{ .Date.Format "January 2, 2006" }}
              </time>
              {{ with .Params.category }}
              <span>&bull;</span>
              <span class="capitalize">{{ . }}</span>
              {{ end }}
            </div>
            {{ with .Params.description }}
            <p class="text-gray-600 mb-0">{{ . | truncate 150 }}</p>
            {{ end }}
          </a>
          {{ end }}
        </div>

        {{ if gt $paginator.TotalPages 1 }}
        <div class="mt-12">
          {{ partial "pagination.html" . }}
        </div>
        {{ end }}
      </div>
      {{ end }}
    </div>
  </div>
</div>
{{ end }}{{/* end if author_key */}}
{{ end }}
